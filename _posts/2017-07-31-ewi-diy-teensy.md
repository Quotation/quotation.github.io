---
layout: post
title:  "自制EWI（Teensy版）"
date:   2017-07-31 00:00:00
categories: maker
---

**更新记录：**
* 2017.07.31 初版，主要介绍硬件制作方法。

---
<br/>

## 一、介绍
本文将介绍一种自制低成本EWI的方法。

电吹管（EWI，Electric Wind Instrument），顾英文名思义，是一种电子的管乐器。吹奏技法和竖笛、萨克斯类似，实际上是一个MIDI控制器，可以接软、硬合成器，合成出各种音色。也就是说只要学一种乐器的演奏，就能演奏出好多种乐器的声音！
另外一个好处是指法比真实乐器规律、易学，手指的位置也可以更人性化。

本项目的目标是，做一支方便DIY的低成本EWI。

1. 方便DIY。不需要专业的硬件、软件开发技能，只需具有基础的焊接、动手组装能力，简单的电脑操作能力，就能做出来。
2. 低成本。只连电脑使用的话，成本200元以内。（市面上EWI产品售价在2500以上。）
3. 方便使用。成品为USB-MIDI接口，可直接连电脑，加个转接头可连iPhone/iPad演奏。轻便易携。

## 二、制作
### 准备
![材料和元器件](/images/20170731/01.jpg)

#### 材料：
* 亚克力管，外径25mm，内径21mm。长300mm。让卖家纵剖成两半。淘宝上买的10元一根。（笛身长度可按自己的喜好确定。除了外观、便携因素外，还跟演奏的姿势有关，较长的笛身演奏时胳膊可以轻松些。）
* 吹嘴可以选择口风琴吹嘴、葫芦丝吹嘴。这两种形状比较合适，也方便买。
* 细橡胶管一小段，内径2.5mm。淘宝搜“PU气管”。
* 铜圆片若干，用做按键。直径大约是手指指肚宽度就好。

#### 元器件：
* Teensy 3.1或3.2。Teensy类似Arduino但配置更高，自带触摸按键控制器、自带USB-MIDI，非常适合做EWI。淘宝上买的99元。
* 气压传感器MPXV7002DP。这个型号的量程较小，精度高。因为演奏时嘴里的气压变化不大，所以需要找精度较高的传感器。
* 导线若干。
* USB-Micro线一根。
* 如果想连iPhone/iPad使用，还需要一个Lightning转USB Camera的转接头。一定要买正版的，山寨产品在iOS 10.3以上不能用。正品比较贵，我买的二手货110元。（如果只是连电脑演奏，不需要这个转接头。）

#### 工具：
* 烙铁、焊锡。
* 热熔胶。
* 电钻或钻孔器。
* 胶带。

### 制作过程
1. 用胶带把两半亚克力管轻轻粘起来，拿在手里摆出吹奏的姿势。微调手指位置，直到两个胳膊和所有手指都感觉舒服。哪只手在上那只手在下可按照自己的习惯来决定，最下面的小指的位置可以偏在一侧，这样按起来比较舒服。

1. 让别人帮忙在亚克力管上标记出手指位置，上面的手需要**大拇指到无名指**，下面的手需要**食指到小指**。并标记出按键**中心**的准确位置用于钻孔。上面的大拇指需要两个标记，分别位于拇指的上方和下方，这两个按键是用来升降8度的，离得可稍微远些，避免误触。

1. 在标记的按键中心处钻孔，直径3.5mm左右就可以，用于走按键的导线。
![钻孔](/images/20170731/02.jpg)

1. 把Teensy放在亚克力管末端，Micro USB口朝外，对照Teesy板上唯一的按键（烧录程序时要用）的位置，在后一半亚克力管上钻个孔。这个孔可以略大些，烧录程序时要能伸个东西进去按按键。

1. 把各元器件对照下图摆好，量出各根导线的长度。Teensy放在笛身末端，方便插拔USB线。气压传感器靠近吹嘴，更灵敏。连接按键的线要多留出一小段余量，方便焊接。所有连接到Teensy的导线先焊上。（TODO：具体的接线方式待补充。）气压传感器的接线也焊好。
![摆位置](/images/20170731/04.jpg)

1. 截取一小段气管，一端插在气压传感器的上进气口，一端接到吹嘴内，用热熔胶密封住。如果吹嘴和气管粗细相差太大，可用胶带缠粗再打胶。

1. Teensy接到电脑上，用Arduino烧录进程序。（TODO：软件部分待补充。）用吹嘴和按键导线简单模拟一下吹奏，确保能正常使用。检查按键的顺序是否正确。检查没问题后，把吹嘴用热熔胶固定在管内壁上，注意吹嘴朝的方向朝后。
![吹嘴](/images/20170731/03.jpg)

1. 按键的导线从孔伸到外面，剪到合适的长度，焊上铜片。注意顺序不要打乱了，待会固定之后就很难调整了。焊点尽量在铜片的中央。焊好后，用胶把铜片粘在笛身上。管内的走线用胶稍为固定。Teensy用胶固定，注意按键要对准后一半管上的孔。
![固定](/images/20170731/05.jpg)

1. 把后一半亚克力管合上，用胶带缠几道固定。因为是DIY，有可能经常拆开做改造，先不用固定得太牢。完成图如下。
![完成](/images/20170731/06.jpg)

## 三、软件
### 源代码
**（软件尚未完善，暂不放出。待到完善后开源，再详细介绍。）**

### 软件烧录
1. 安装Arduino和TeensyStudio。

1. 用Arduino打开代码，连接Teensy，设置，编译。

1. Upload，按一下Teensy上的按键。等待烧录成功。

## 四、使用
### 连接电脑演奏
连电脑比较简单，该EWI相当于一个USB接口的MIDI键盘。自己找软音源软件，此处不多做说明。

在Mac上我是用Hosting AU + Synth1的AU插件做合成器；Windows上没有试过。

### 连iPhone/iPad演奏
连iPhone/iPad需要一些技巧。如前所说，需要一个Lightning转USB Camera转接头。EWI接在转接头上，转接头再插在iOS设备上。

技巧1：注意要先接上EWI，再打开合成器App。这一点跟MIDI键盘的使用一样。如果已经打开着App，需要先退出，再插EWI，再开App，才能正常使用。

技巧2：iOS对外接的USB设备有电流限制。因为本EWI直接从USB接口取电，如果使用电流较大（比如加上LED灯光效果），连接上后可能会没反应。技巧是：转接头上先接个USB HUB，再把EWI插在USB HUB上。这样iOS就会放宽电流限制。（想更便携的话，还可以用USB HUB模块，做出一根自带HUB的USB-Micro线。此处暂不详述。）

### EWI设置
（未完成，待补充。）
